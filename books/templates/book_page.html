{% extends "navbar.html" %}

{% block body %}

<div class="book-details">
    <h1>{{ book.title }}</h1>
    <img src="{{ book.image.url }}" alt="{{ book.title }}" class="img-fluid book-image">
    <p><strong>Author:</strong> {{ book.author.author_name }}</p>
    <p><strong>Genres:</strong> {% for genre in book.genres.all %}{{ genre.name }}{% if not forloop.last %}, {% endif %}{% endfor %}</p>
    <p><strong>Number of Pages:</strong> {{ book.n_pages }}</p>
    <p><strong>Publication Year:</strong> {{ book.publication_year }}</p>
    <h3>Other books by {{ book.author.author_name }}</h3>
    <ul>
        {% for other_book in other_books %}
        <li><a href="{% url 'books:book_page' other_book.title %}">{{ other_book.title }}</a></li>
        {% endfor %}
    </ul>

    {% if not in_shelf %}
    <form method="post" action="{% url 'books:add_to_shelf' book.id %}">
        {% csrf_token %}
        <button type="submit" class="btn btn-primary">Add to Shelf</button>
    </form>
    {% else %}
    <form method="post" action="{% url 'books:remove_from_shelf' book.id %}">
        {% csrf_token %}
        <button type="submit" class="btn btn-danger">Remove from Shelf</button>
    </form>
    {% endif %}
</div>

<!-- Comment Form -->
<div class="card mt-4">
    <div class="card-body">
        <h5 class="card-title">Add Comment</h5>
        <form id="comment-form" method="POST" action="{% url 'books:add_comment' book.id book.title %}">
            {% csrf_token %}
            <div class="form-group">
                <textarea id="content" name="content" class="form-control mb-2" rows="3" placeholder="Write a comment"></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Submit</button>
        </form>
    </div>
</div>


<div class="card mt-4">
    <div class="card-body">
        <!-- Comments Section -->
        <h5 class="card-title">Comments</h5>
        <div id="comments-container">
            {% for comment in comments %}
                <div class="card mb-3">
                    <div class="card-body">
                        <p class="card-text">{{ comment.text }}</p>
                        <p class="card-text"><small class="text-muted">By: {{ comment.user.username }} | {{ comment.created_at }}</small></p>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
</div>

{% endblock %}